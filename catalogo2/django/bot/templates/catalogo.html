{% extends 'layout.html' %}
{% load static %}

{% block catalogo %}


<!-- Option 1: Include in HTML -->
<!-- Select2 CSS -->

<script src="https://unpkg.com/chart.js@2.8.0/dist/Chart.bundle.js"></script>
<script src="https://unpkg.com/chartjs-gauge@0.3.0/dist/chartjs-gauge.js"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">


<!-- indicador tecnico -->

 <style>
   .stretch-card>.card {
     width: 100%;
     min-width: 100%
 }

 body {
     background-color: #f9f9fa
 }

 .flex {
     -webkit-box-flex: 1;
     -ms-flex: 1 1 auto;
     flex: 1 1 auto
 }

 @media (max-width:991.98px) {
     .padding {
         padding: 1.5rem
     }
 }

 @media (max-width:767.98px) {
     .padding {
         padding: 1rem
     }
 }

 .padding {
     padding: 3rem
 }
 
 .card {
     box-shadow: none;
     -webkit-box-shadow: none;
     -moz-box-shadow: none;
     -ms-box-shadow: none
 }

 .card {
     position: relative;
     display: flex;
     flex-direction: column;
     min-width: 0;
     word-wrap: break-word;
     background-color: #fff;
     background-clip: border-box;
     border: 1px solid #3da5f;
     border-radius: 0
 }
 
 .card .card-block {
    padding: 1.25rem;
}

h6 {
    font-size: 16px !important;
}

.text-c-green {
    color: #2ed8b6;
}

.m-l-10 {
    margin-left: 10px;
}

.proj-progress-card .progress {
    height: 6px;
    overflow: visible;
    margin-bottom: 10px;
}

.proj-progress-card .progress .progress-bar {
    position: relative;
}

.progress .progress-bar {
    height: 100%;
    color: inherit;
}

.bg-c-red {
    background: #FF5370;
}

.proj-progress-card .progress .progress-bar.bg-c-red:after {
    border: 3px solid #FF5370;
}

.proj-progress-card .progress .progress-bar:after {
    content: "";
    background: #fff;
    position: absolute;
    right: -6px;
    top: -4px;
    border-radius: 50%;
    width: 15px;
    height: 15px;
}

.bg-c-blue {
    background: #4099ff;
}

.proj-progress-card .progress .progress-bar.bg-c-blue:after {
    border: 3px solid #4099ff;
}

.proj-progress-card .progress .progress-bar.bg-c-green:after {
    border: 3px solid #2ed8b6;
}

.bg-c-green {
    background: #2ed8b6;
}

.bg-c-yellow {
    background: #FFB64D;
}

.proj-progress-card .progress .progress-bar.bg-c-yellow:after {
    border: 3px solid #FFB64D;
}

.m-b-30 {
    margin-bottom: 30px;
}

.text-c-red {
    color: #FF5370;
}





 </style> 
<!-- indicador tecnico -->

<style>
  ::placeholder{
color: white;
}
</style>
<!-- STILOS SELECT2 -->
<style>
  .select2-container--default .select2-selection--multiple {
      width: 150px;
      margin-top: 0px; 
      filter: drop-shadow(0px 0px 16px rgba(107, 228, 255, 0.34));
      color: #ebeff1;
      border: 2px solid #00a7ff;
      border-radius: 20px; 
      font-weight: 300;
      font-size: 16px;
      line-height: 25px;
      background-color:transparent;
  }
  .select2-dropdown {
      background-color: skyblue;
      border: 1px solid #aaa;
      border-radius: 20px;
      box-sizing: border-box;
      display: block;
      position: absolute;
      width: 200px;
      z-index: 1051
  }
  .select_catalogo > dropdown {
      background-color: skyblue;
      border-radius: 20px;
    
   }  

                

.select2-container--default .select2-selection--multiple .select2-selection__choice {

   background-color: transparent;
   border: none;
}
		
.select2-container--default.select2-container--focus .select2-selection--multiple {
    border: 2px solid #00a7ff;
    outline: 0
}    
</style>
<!-- STILOS SELECT2 -->
<script>
  var click = true;
</script>

<style>
  /* Estilos para el modal */
.modal {
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.4);
}

/* Contenido del modal */
.modal-content {
  background-color: #fff;
  margin: 15% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}

/* Botón de cierre */
.close {
  color: #aaa;
  float: right;
  font-size: 29px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

</style>

<div class="container" style="text-align: right;">
<div id="myModal2" class="modal" style="width: 100%;">
  <div style="width: 30%;" class="modal-content">
  <span  id="cerrar2" style="cursor: pointer; font-size: 25px;"> &times;</span>
   <p style="text-align: center;">Tienes verificación TWO FACTOR activada, digita el codigo que fue enviado a tu celular para poder acceder.</p>
  <input id="twofactor" type="number"> 
  <button onclick="conectar2()" style="height: 50px; margin-top: 10px;" id="factor">Enviar</button>

  </div>
</div>
</div>

<script>
  var closeButton2 = document.getElementById("cerrar2");
  closeButton2.onclick = function() {
  document.getElementById('myModal2').style.display = "none";
}
</script>


<!-- Modal -->
<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <span id="money" style="margin-bottom: 7px;">Money:</span>
    
  
 
<style>
        table {
  border: 1px solid #ccc;
  border-collapse: collapse;
  margin: 0;
  padding: 0;
  width: 100%;
  table-layout: fixed;
}

table caption {
  font-size: 1.5em;
  margin: .5em 0 .75em;
}

table tr {
  background-color: #f8f8f8;
  border: 1px solid #ddd;
  padding: .35em;
}

table th,
table td {
  padding: .625em;
  text-align: center;
}

table th {
  font-size: .85em;
  letter-spacing: .1em;
  text-transform: uppercase;
}

@media screen and (max-width: 600px) {
  table {
    border: 0;
  }

  table caption {
    font-size: 1.3em;
  }
  
  table thead {
    border: none;
    clip: rect(0 0 0 0);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px;
  }
  
  table tr {
    border-bottom: 3px solid #ddd;
    display: block;
    margin-bottom: .625em;
  }
  
  table td {
    border-bottom: 1px solid #ddd;
    display: block;
    font-size: .8em;
    text-align: right;
  }
  
  table td::before {
    /*
    * aria-label has no advantage, it won't be read inside a table
    content: attr(aria-label);
    */
    content: attr(data-label);
    float: left;
    font-weight: bold;
    text-transform: uppercase;
  }
  
  table td:last-child {
    border-bottom: 0;
  }
}

</style>
    
      <table>
        <caption><button style="background-color: #acd7ee;" onclick="clear_historial()" class="btn">Clear</button></caption>
        <thead>
          <tr>
            <th scope="col">No</th>
            <th scope="col">Estado</th>
            <th scope="col">Monto</th>
            <th scope="col">Estrategia</th>
            <th scope="col">Divisa</th>
            <th scope="col">Martingala</th>
            <th scope="col">Fecha</th>
          
          </tr>
        </thead>
        <tbody id="tabla_historial">
          
        </tbody>
      </table>
    
   
      <script>
        function historial(){
            var tabla = ''; // Declaración de la variable fuera del bucle
            document.getElementById('tabla_historial').innerHTML = tabla;
            document.getElementById('money').innerHTML =` Money: 0.00`;
            document.getElementById('money').style.color = 'black';
            $.ajax({
                type: "GET", // Tipo de solicitud
                url: "/historial", // URL a la que se hace la solicitud
                success: function(data) {
                    // Función que se ejecuta si la solicitud es exitosa.
                    
                    for (var i = 0; i < data.length; i++) {                  
                        var historial = data[i];
                      
                        if(historial.estado == 'Win'){
                          tabla += `<tr style="color:green;">
                            <td style="width:20px;" data-label="Estado">${i}</td>
                            <td data-label="Estado">${historial.estado}</td>
                            <td data-label="Monto">${historial.ganancia}</td>
                            <td data-label="Estrategia">${historial.estrategia}</td>
                            <td data-label="Divisa">${historial.divisa}</td>
                            <td data-label="Martingala">${historial.martingala}</td>
                            <td data-label="fecha">${historial.fecha}</td>
                
                        </tr>`;
                        }
                        if(historial.estado == 'Loose'){
                        tabla += `<tr style="color:red;">
                            <td style="width:20px;" data-label="Estado">${i}</td>
                            <td data-label="Estado">${historial.estado}</td>
                            <td data-label="Monto">${historial.ganancia}</td>
                            <td data-label="Estrategia">${historial.estrategia}</td>
                            <td data-label="Divisa">${historial.divisa}</td>
                            <td data-label="Martingala">${historial.martingala}</td>
                            <td data-label="fecha">${historial.fecha}</td>
                
                        </tr>`;
                      }
                      if(historial.estado == 'Equal'){
                        tabla += `<tr style="color:blue;">
                            <td style="width:20px;" data-label="Estado">${i}</td>
                            <td data-label="Estado">${historial.estado}</td>
                            <td data-label="Monto">${historial.ganancia}</td>
                            <td data-label="Estrategia">${historial.estrategia}</td>
                            <td data-label="Divisa">${historial.divisa}</td>
                            <td data-label="Martingala">${historial.martingala}</td>
                            <td data-label="fecha">${historial.fecha}</td>
                
                        </tr>`;
                      }
                    }
                    
                    if(historial.amount > 0 ){  
                           document.getElementById('money').innerHTML =` Money: +${historial.amount}`;
                           document.getElementById('money').style.color = 'green';
                          }
                    if(historial.amount < 0 ){  
                      document.getElementById('money').innerHTML =` Money: ${historial.amount}`;
                      document.getElementById('money').style.color = 'red';
                    }   
                    
                    if(historial.amount == 0 ){  
                      document.getElementById('money').innerHTML =` Money: ${historial.amount}`;
                      document.getElementById('money').style.color = 'blue';
                    }
                 
                    document.getElementById('tabla_historial').innerHTML = tabla;
                },
                error: function() {
                    // Función que se ejecuta si hay un error en la solicitud.
                    resultado.html("Error en la solicitud AJAX.");
                }
            });
        }
        

        function clear_historial(){
            $.ajax({
                type: "GET", // Tipo de solicitud
                url: "/clear_historial", // URL a la que se hace la solicitud
                success: function(data) {
                          document.getElementById('money').innerHTML =` Money: 0.00`;
                          document.getElementById('tabla_historial').innerHTML = "";
                          document.getElementById('mensajes').innerHTML = 'Advice: ' + data.mensaje
                },
                error: function() {
                    // Función que se ejecuta si hay un error en la solicitud.
                    resultado.html("Error eliminando mensajes.");
                }
            });
        }
</script>
        

  </div>
</div>

<script>
var historialLink = document.getElementById("historialLink");
var modal = document.getElementById("myModal");
var closeButton = document.getElementsByClassName("close")[0];

historialLink.onclick = function() {
  historial()
  modal.style.display = "block";
  
}

closeButton.onclick = function() {
  modal.style.display = "none";
}

window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
</script>
<!-- Modal -->


{% if request.user.plan == "premium" %}
<h1 id="mensajes" style="font-size: 14px; color: white; text-align: center; margin-top: 5px;">Advice: Esta es tu seccion de mensajes.</h1>
<div id="panel_config"  class="row gap-3" style="margin-left: 50px; margin-top: 7px; margin-right: 53px;">

    <div class="col-xl card " style=" width: 23rem; background: radial-gradient(50% 50% at 50% 50%, #00A3FF 0%, #003C74 100%); border-radius: 0px;">
        <img src="{% static 'img/analisis.png' %}" alt="Portada" width="100%" style="border-radius: 30px; margin-top: 8px;">
        <div class="card-body">

          <div class="row">
            <div class="col-1"></div>
            <div style="margin-top: 9px;" class="col">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="check_tecnico">
                <label style="color: white;" class="form-check-label" for="flexSwitchCheckDefault">Active el analisis tecnico.</label>
              </div>
          </div>  
          </div>

          <div style="margin-top: 10px;">
            
          <p class="card-text"><span style="color: white;">
            -Simple Moving Average (10)<br> 
            -Relative Strength Index (14)<br>
            -Stochastic %K (14, 3, 3)<br> 
            -Exponential Moving Average (5)<br>
            -Not working on the OTC market
          
          </span></p>
           
          </div>
     
  <div class="container" style="display: flex; justify-content: center; align-items: center;">
    <div id="canvas-holder" style="width:130%">
      <canvas id="chart"></canvas>
    </div>
  </div>

  
    <script>
      var randomScalingFactor = function() {
  return Math.round(Math.random() * 100);
};



var data = [35, 65, 100];
var value = 1

var config = {
  type: 'gauge',
  data: {
    //labels: ['Success', 'Warning', 'Warning', 'Error'],
    datasets: [{
      data: data,
      value: value,
      backgroundColor: ['red', 'yellow', 'green'],
      borderWidth: 2
    }]
  },
  options: {
    responsive: true,
    title: {
      display: true,
    },
    layout: {
      padding: {
        bottom: 30
      }
    },
    needle: {
      // Needle circle radius as the percentage of the chart area width
      radiusPercentage: 2,
      // Needle width as the percentage of the chart area width
      widthPercentage: 3.2,
      // Needle length as the percentage of the interval between inner radius (0%) and outer radius (100%) of the arc
      lengthPercentage: 80,
      // The color of the needle
      color: 'rgba(0, 0, 0, 1)'
    },
    valueLabel: {
      formatter: function(value) {
        // Cambia el valor a "Venta" o "Compra" en función de la posición
        if (value == 17) {
          return 'Venta';
        } else if (value == 50)  {
          return 'Espera';
        } else if (value == 73)  {
          return 'Compra';
        }  else if (value == 1)  {
          return 'Off';
        }
    }
   }
  }
};

window.onload = function() {
  var ctx = document.getElementById('chart').getContext('2d');
  window.myGauge = new Chart(ctx, config);
};

    </script>
  
    </div>
    </div>


   <div class="col-xl  card" style=" width: 23rem; background: radial-gradient(50% 50% at 50% 50%, #00A3FF 0%, #003C74 100%); border-radius: 0px;">
    <img src="{% static 'img/conecta.png' %}" alt="Portada" width="100%" style="border-radius: 30px; margin-top: 8px;">
    <div class="card-body">
      

      <div style="color: azure;" class="row">
        <div class="col">Estado</div> 
              <div class="col">Modo</div> 
              <div class="col">Balance</div> 
          </div>  
       

      <div style="color: #35b8ff;" class="row">
            <div class="col" id="estado">Offline</div> 
            <div class="col" id="modo2">--</div> 
            <div class="col" id="balance">--</div> 
      </div>

      
<style>
  #email::placeholder  {
  color: white;
}
#password::placeholder  {
  color: white;
}
</style>
      <input class="form-control" style="
                   width: 100%;
                   margin-top: 10px; filter: drop-shadow(0px 0px 16px rgba(107, 228, 255, 0.34));
                   height: 40px;
                   color: #eff5f8;
                   border: 2px solid #00a7ff;
                   border-radius: 73px; 
                   font-weight: 300;
                   font-size: 16px;
                   line-height: 25px;
                   background-color:transparent;   
                         
      " type="email" id="email" required  size="10" placeholder="Email">

      <input class="form-control" style="
      width: 100%;
      margin-top: 10px; filter: drop-shadow(0px 0px 16px rgba(107, 228, 255, 0.34));
      height: 40px;
      color: #ecf1f3;
      border: 2px solid #00a7ff;
      border-radius: 73px; 
      font-weight: 300;
      font-size: 16px;
      line-height: 25px;
      background-color:transparent;"
       type="password" id="password" required  size="10" placeholder="Password">

      <select class="form-control" id="modo" style="
      width: 100%;
      margin-top: 5px; filter: drop-shadow(0px 0px 16px rgba(107, 228, 255, 0.34));
      height: 40px;
      color: #f5f7f8;
      border: 2px solid #00a7ff;
      border-radius: 73px; 
      font-weight: 300;
      font-size: 16px;
      line-height: 25px;
      background-color:transparent;
      cursor: pointer;"
      >
      <option style="color: #100c46;"  value="NONE">Practica / Real</option>  
      <option style="color: #100c46;"  value="PRACTICE">Practica</option>
      <option style="color: #100c46"   value="REAL">Real</option>
        </select>

      <div class="row">
      <div class="col"> 
      <input id="conectar_iq" type="button" style="
      margin-top: 14px; filter: drop-shadow(0px 0px 16px rgba(107, 228, 255, 0.34));width: 140px;
      height: 40px;
      margin-top: 20px;
      color: #35b8ff;
      border: 2px solid #00a7ff;
      border-radius: 73px; 
      font-weight: 300;
      font-size: 16px;
      line-height: 25px;
      background-color:transparent;"
      
      
      value="CONNECT" onclick="conectar();">
      {% if request.user.plan == "free" or request.user.plan == "regular" %}
      <script>
         document.getElementById('conectar_iq').disabled = true
      </script>
      {% endif %}

    </div>
    </div>
    </div>
   </div>


   <div class="col-xl card" style=" width: 23rem; background: radial-gradient(50% 50% at 50% 50%, #00A3FF 0%, #003C74 100%); border-radius: 0px;">
    <img src="{% static 'img/auto.png' %}" alt="Portada" width="100%" style="border-radius: 30px; margin-top: 8px;">
    <div class="card-body">
      <h5 style="color: white;" class="card-title">Selecciona una estrategia</h5>
      <select onchange="estrategia_body();" class="form-control" id="estrategias" style="width: 100%;  margin-top: 5px ;
      margin-top: 0px; filter: drop-shadow(0px 0px 16px rgba(107, 228, 255, 0.34));
      height: 40px;
      color: #f5f7f8;
      border: 2px solid #00a7ff;
      border-radius: 73px; 
      font-weight: 300;
      font-size: 16px;
      line-height: 25px;
      background-color:transparent;
      cursor: pointer;
      ">
        <option style="color: #100c46;" value="">Seleccionar Estrategia</option> 
        {% for x in estrategias %} 
       <option style="color: #100c46;" data-importe='{{x.importe}}' data-martingala='{{x.martingala}}' data-tipo_martingala='{{x.tipo_martingala}}' data-modo_entrada='{{x.modo_entrada}}' data-num_operaciones='{{x.num_operaciones}}' data-after_loss='{{x.after_loss}}' data-after_loss_num='{{x.after_loss_num}}' data-after_loss_martingala='{{x.after_loss_martingala}}'  data-mensaje='{{x.mensaje}}'  id='{{x.id}}estrategia' value='{{x.id}}'>{{ x.nombre }}  | by {{ x.username }}</option>
       {% endfor %}
        </select>
       
        <p class="card-text" style=" margin-top: 15px;"><span id="estrategia_mensaje" style="color: white; margin-left: 5px;"> Si lo deseas, selecciona una estrategia recomendada por nuestra comunidad.</span></p>
      
      <script>
      function estrategia_body(){
        const mensaje_estrategia = document.getElementById('estrategias').value
        const mensaje_estrategia2 = document.getElementById(`${mensaje_estrategia}estrategia`).dataset.mensaje
        var mensaje_ = mensaje_estrategia2.substring(0, 200);
        document.getElementById('estrategia_mensaje').innerHTML =  mensaje_
       

      }
      </script>

     <div style="text-align: right;">
      <input id="put_estrategia" style="
      margin-top: 20px; filter: drop-shadow(0px 0px 16px rgba(107, 228, 255, 0.34));width: 140px;
      height: 40px;
      color: #35b8ff;
      border: 2px solid #00a7ff;
      border-radius: 73px; 
      font-weight: 300;
      font-size: 16px;
      line-height: 25px;
      background-color:transparent;
      bottom: 0;
      "
      type="button" value="SET" onclick="put_estrategia();"> 
      <script>
        function put_estrategia(){
         
             const mensaje_ = document.getElementById('estrategias').value
             document.getElementById('importe').value = document.getElementById(`${mensaje_}estrategia`).dataset.importe
             document.getElementById('martingala').value = document.getElementById(`${mensaje_}estrategia`).dataset.martingala
             document.getElementById('tipo_martingala').value = document.getElementById(`${mensaje_}estrategia`).dataset.tipo_martingala
             document.getElementById('modo_entrada').value = document.getElementById(`${mensaje_}estrategia`).dataset.modo_entrada
             document.getElementById('operaciones').value = document.getElementById(`${mensaje_}estrategia`).dataset.num_operaciones
             document.getElementById('after_loss').value = document.getElementById(`${mensaje_}estrategia`).dataset.after_loss
             document.getElementById('operaciones_al').value = document.getElementById(`${mensaje_}estrategia`).dataset.after_loss_num
             document.getElementById('martingala_al').value = document.getElementById(`${mensaje_}estrategia`).dataset.after_loss_martingala
             document.getElementById('stop_gain').value = 0
             document.getElementById('stop_loss').value = 0
        }
      </script>
    </div>



    </div>
  </div>


  <div class="col-xl card" style=" width: 23rem; background: radial-gradient(50% 50% at 50% 50%, #00A3FF 0%, #003C74 100%); border-radius: 0px;">
    <img src="{% static 'img/manual.png' %}" alt="Portada" width="100%" style="border-radius: 30px; margin-top: 8px;" >
    <div class="card-body">
    
      <div class="row g-2">

      <div class="col">
        
      <input class="form-control" style="width: 100%; margin-top: 5px; background-color: #a6c292" type="number" id="importe" required  size="10" placeholder="Importe USD$">
      <div class="row g-2">
        <div hidden class="col"><select class="form-control" id="modo_importe" style="width: 100%;  margin-top: 5px; background-color: #a6c292"> 
          <option value="fijo" selected>Modo</option>
         <option value="fijo">Fijo</option>
         <option value="auto">Auto</option>
        </select></div>
        <div hidden class="col"><input class="form-control" style="width: 100%; margin-top: 5px; background-color: #a6c292;" type="number" id="num_modo_importe" required  size="10" placeholder="Num"></div>
        
       </div>
      <select class="form-control" id="martingala" style="width: 100%;  margin-top: 13px; background-color: #e6e8d6; cursor: pointer;">
      <option value="0">Martingala</option> 
      <option value="0">0 Mg</option>
     <option value="1">1 Mg</option>
     <option value="2" selected>2 Mg</option>
     <option value="3">3 Mg</option>
     <option value="4">4 Mg</option>
      <option value="5">5 Mg</option>
      </select>
      <select class="form-control" id="tipo_martingala" style="width: 100%;  margin-top: 5px; background-color: #e6e8d6; cursor: pointer;">
        <option value="double">Tipo Mg</option> 
        <option value="double">Double</option>
       <option value="single">Single</option>
      
        </select>
      
        <select class="form-control" id="modo_entrada" style="width: 100%;  margin-top: 5px; cursor: pointer;">
          <option value="0" selected>Modo Entrada</option> 
         <option value="2">Vela 2</option>
         <option value="3">Vela 3</option>
         <option value="4">Vela 4</option>
          <option value="5">Vela 5</option>
          </select>

      <input class="form-control" style="width: 100%;  margin-top: 5px;" type="number" id="operaciones" required  size="10" placeholder="Num. Operaciones">
      


      </div>


      <div class="col">
      

        <select onchange="habilitarInputs()" class="form-control" id="after_loss" style="width: 100%;  margin-top: 5px;  background-color: #e7b5b5; cursor: pointer;">
         <option value="0" selected>After Loss</option>  
         <option value="1">1</option>
         <option value="2">2</option>
         <option value="3">3</option>
         </select>

          
         <input class="form-control" style="width: 100%; margin-top: 5px;  background-color: #e7b5b5; " type="number" id="operaciones_al" required  size="10" placeholder="Num. Ope">
         
         <select class="form-control" id="martingala_al" style="width: 100%;  margin-top: 5px;   background-color: #e7b5b5; cursor: pointer;"> 
         <option value="0" selected>0 Mg</option>
         <option value="1">1 Mg</option>
         <option value="2">2 Mg</option>
         <option value="3">3 Mg</option>
         <option value="4">4 Mg</option>
          </select>
         
          <script>
                        var select = document.getElementById("after_loss");
                        var input1 = document.getElementById("operaciones_al");
                        var input2 = document.getElementById("martingala_al");
                        
                        if (select.value === "0") {
                          input1.disabled = true;
                          input2.disabled = true;
                          input1.style.opacity = 0.5;
                          input2.style.opacity = 0.5;
                        } else {
                          input1.disabled = false;
                          input2.disabled = false;
                          input1.style.opacity = 1;
                          input2.style.opacity = 1;
                        }

            function habilitarInputs() {
                        var select = document.getElementById("after_loss");
                        var input1 = document.getElementById("operaciones_al");
                        var input2 = document.getElementById("martingala_al");
                        
                        if (select.value === "0") {
                          input1.disabled = true;
                          input2.disabled = true;
                          input1.style.opacity = 0.5;
                          input2.style.opacity = 0.5;
                        } else {
                          input1.disabled = false;
                          input2.disabled = false;
                          input1.style.opacity = 1;
                          input2.style.opacity = 1;
                        }
                      }
          </script>

         <input readonly class="form-control" style="width: 100%; margin-top: 5px;" type="number" id="stop_gain" required  size="10" placeholder="Stop Gain">
         <input readonly class="form-control" style="width: 100%; margin-top: 5px;" type="number" id="stop_loss" required  size="10" placeholder="Stop Loss">
  
      </div>

      </div>

      <div  class="row" style="margin-top: 6px; text-align: center;" >
        <div class="col">
        <div id="ganadas" style=" font-size: 15px; color: white;">Win: 0</div>

      <input id="start" style="
      margin-top: 14px; filter: drop-shadow(0px 0px 16px rgba(107, 228, 255, 0.34));width: 140px;
      width: 100px;
      height: 40px;
      margin-top: 20px;
      color: #35b8ff;
      border: 2px solid #00a7ff;
      border-radius: 73px; 
      font-weight: 300;
      font-size: 16px;
      line-height: 25px;
      background-color:transparent;"
      type="button" value="START" onclick="buy_sell();"> 

        </div>

       <div class="col">
        <div id="perdidas" style=" font-size: 15px; color: white;">Loose: 0</div>
        <input id="stop"  style="
      margin-top: 14px; filter: drop-shadow(0px 0px 16px rgba(107, 228, 255, 0.34));width: 140px;
      width: 100px;
      height: 40px;
      margin-top: 20px;
      color: #35b8ff;
      border: 2px solid #00a7ff;
      border-radius: 73px; 
      font-weight: 300;
      font-size: 16px;
      line-height: 25px;
      background-color:transparent;
      "
        type="button" value="STOP" onclick="stop();"> 
      </div>

      {% if request.user.plan == "free" or request.user.plan == "regular" %}
      <script>
         document.getElementById('start').disabled = true
         document.getElementById('stop').disabled = true
      </script>
      {% endif %}


      <div> <p style="color: white; margin-top: 5px;" id="ordenes_enviadas" ></p>   </div>


      </div>
          
       </div>

    </div>
  </div>
{% endif %} 



</div>

<hr class="hr" style=" border-top: 1px solid #e2b66b; background-color: #e2b66b;" />


<!-- CATALOGO CONFIG -->
<div class="alert alert-dark" style="margin-left: 2.6%; margin-right: 2.6%; background: rgba(30, 77, 120, 0.5799999833106995);opacity: 0.7;border: 0;" role="alert">

  <style>
    table {
  border: none;
  border-collapse: collapse;
  margin: 0;
  padding: 0;
  width: 100%;
  table-layout: fixed;
}

table caption {
  font-size: 1.5em;
  margin: .5em 0 .75em;
}

table tr {
  background-color: transparent;
  border:none;
  padding: .35em;
}

table th,
table td {
  color: aliceblue;
  padding: .625em;
  text-align: center;
}

table th {
  font-size: .85em;
  letter-spacing: .1em;
  text-transform: uppercase;
}

@media screen and (max-width: 980px) {
  table {
    border: 0;
  }

  table caption {
    font-size: 1.3em;
  }
  
  table thead {
    border: none;
    clip: rect(0 0 0 0);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px;
  }
  
  table tr {
    border-bottom: none;
    display: block;
    margin-bottom: .625em;
  }
  
  table td {
    border-bottom: none;
    display: block;
    font-size: .8em;
    text-align: right;
    top: 5px;
  }
  
  table td::before {
    /*
    * aria-label has no advantage, it won't be read inside a table
    content: attr(aria-label);
    */
    content: attr(data-label);
    float: left;
    font-weight: bold;
    
  }
  
  table td:last-child {
    border-bottom: 0;
  }
}

  </style>

  <table>
    <thead>
      <tr>
        <th scope="col">Catálogo</th>
        <th scope="col">Martingala</th>
        <th scope="col">Cuadrantes</th>
        <th scope="col">Pares</th>
        <th scope="col">Estrategia</th>
        <th scope="col">Bin. / Digital</th>
      </tr>
    </thead>
    <tbody>
      <tr> 

        <td data-label="Catálogo">
          <img width="100px" src="https://static.wixstatic.com/media/90a303_d1f01b36f3bc47d88c3bc1b880f4c15e~mv2.gif" alt="">
        </td>

        <td data-label="Martingala">
          
        
            <select  class="select_catalogo" id="mg_catalogo" style="
            margin-top: 0px; filter: drop-shadow(0px 0px 16px rgba(107, 228, 255, 0.34));
                       width: 100px;
                       height: 39px;
                       color: #e6eef1;
                       border: 2px solid #00a7ff;
                       border-radius: 73px; 
                       font-weight: 300;
                       font-size: 16px;
                       line-height: 25px;
                       background-color:transparent;
                       cursor: pointer;
            ">
              {% if request.user.plan == "premium" or request.user.plan == "regular" %}
              <option style="color: #003C74;" value="0">0 Mg</option>
              <option style="color: #003C74;"value="1">1 Mg</option>
              {% endif %}
              <option style="color: #003C74;"value="2" selected>2 Mg</option>
              {% if request.user.plan == "premium" or request.user.plan == "regular" %}
              <option style="color: #003C74;"value="3">3 Mg</option>
              <option style="color: #003C74;"value="4">4 Mg</option>
              <option style="color: #003C74;"value="5">5 Mg</option>
              {% endif %}
            </select>
    
            <script>
                  var selectElement_mg = document.getElementById("mg_catalogo");
    
                  selectElement_mg.addEventListener("change", function() {
                          catalogo('allow');
                  });
    
            </script>
         
        </td>

        <td data-label="Cuadrantes">
          <select  class="" id="cuadrantes_catalogo" style="
        margin-top: 0px; filter: drop-shadow(0px 0px 16px rgba(107, 228, 255, 0.34));
                    width: 100px;
                   height: 39px;
                   color: #eff5f8;
                   border: 2px solid #00a7ff;
                   border-radius: 73px; 
                   font-weight: 300;
                   font-size: 16px;
                   line-height: 25px;
                   background-color:transparent;
                   cursor: pointer;
        ">
          <option style="color: #003C74;"value="24"  selected>24</option>
          <option style="color: #003C74;"value="48">48</option>
          {% if request.user.plan == "free" %}
          {% else %}
          <option style="color: #003C74;"value="96">96</option>
          <option style="color: #003C74;"value="192">192</option>
          {% endif %}
        </select>

        <script>
          var selectElement_cuadrante = document.getElementById("cuadrantes_catalogo");

          selectElement_cuadrante.addEventListener("change", function() {
                  catalogo('allow');
          });

    </script>
        </td>

        <td data-label="Pares">
                    <select  multiple="multiple" id="pares_catalogo" style="
                    width: 150px;
                    height: 30px;
                    color: #eff5f8;
                    border: 2px solid #00a7ff;
                    border-radius: 73px; 
                    font-weight: 300;
                    font-size: 16px;
                    line-height: 25px;
                    background-color:transparent;
                    cursor: pointer;
                      ">
                      </select>
                      <script>

                      var selectElement_pares = $("#pares_catalogo");
                      selectElement_pares.on("change", function() {
                        catalogo('allow');
                      });

                      </script>

        </td>

        <td data-label="Estrategia">
          <select multiple="multiple" id="estrategia_catalogo" style="
          width: 150px;
          margin-top: 0px; filter: drop-shadow(0px 0px 16px rgba(107, 228, 255, 0.34));
          height: 40px;
          color: #eff5f8;
          border: 2px solid #00a7ff;
          border-radius: 73px; 
          font-weight: 300;
          font-size: 16px;
          line-height: 25px;
          background-color:transparent;
          cursor: pointer;
">
</select>
        </td>

        <td data-label="Bin. / Digital">


          <style>
            
            :root {
  --body: #fafafa;
  --text-default: #1d1d1f;
  --text-secondary: #86868b;
}
@media (prefers-color-scheme: light) {
  :root {
    --body: #fafafa;
    --text-default: #1d1d1f;
  }
}
@media (prefers-color-scheme: dark) {
  :root {
    --body: #161616;
    --text-default: #f5f5f7;
  }
}

/* Checkbox Styles */
.opciones{
  -webkit-appearance: none;
  outline: none;

  height: 3rem;
  width: 11rem;
  border: 2px solid var(--body);
  border-radius: 2.5rem;
  cursor: pointer;
  box-shadow: 9px 9px 16px rgba(189, 189, 189, 0.6), -9px -9px 16px rgba(255, 255, 255, 0.5), inset 10px 10px 15px -10px #c3c3c3, inset -10px -10px 15px -10px #fff;
  /* Toggle Indicator */
  /* Label */
  /* Checked Styles */
}
@media (prefers-color-scheme: light) {
  .opciones{
    box-shadow: 9px 9px 16px rgba(189, 189, 189, 0.6), -9px -9px 16px rgba(255, 255, 255, 0.5), inset 10px 10px 15px -10px #c3c3c3, inset -10px -10px 15px -10px #fff;
  }
}
@media (prefers-color-scheme: dark) {
  .opciones{
    box-shadow: -8px -4px 8px 0px rgba(255, 255, 255, 0.05), 8px 4px 12px 0px rgba(0, 0, 0, 0.5), inset -4px -4px 4px 0px rgba(255, 255, 255, 0.05), inset 4px 4px 4px 0px rgba(0, 0, 0, 0.5);
  }
}
.opciones::before {
  content: "";
  height: 3.125rem;
  width: 3.125rem;
  background-color: var(--body);

  margin: auto;
  top: 0;
  left: 2rem;
  bottom: 0;
  border-radius: 50%;
  box-shadow: 7px 7px 15px #c3c3c3, 9px 9px 16px rgba(189, 189, 189, 0.6);
  transition: 0.15s;
}
@media (prefers-color-scheme: light) {
  .opciones::before {
    box-shadow: 7px 7px 15px #c3c3c3, 9px 9px 16px rgba(189, 189, 189, 0.6);
  }
}
@media (prefers-color-scheme: dark) {
  .opciones::before {
    box-shadow: -8px -4px 8px 0px rgba(255, 255, 255, 0.05), 8px 4px 12px 0px rgba(0, 0, 0, 0.5);
  }
}
.opciones::after {
  content: "Digital";
  margin-left: 27px;

  font-size: 1.625rem;
  top: 0rem;
  right: 1rem;
  color: #f5f5f7;
  font-family: "SF Pro Text", "Helvetica Neue", "Helvetica", "Arial", sans-serif;
  font-weight: 200;
  letter-spacing: 0.004em;
}
.opciones:checked {
  background: #0071e3;
}
@media (prefers-color-scheme: light) {
  .opciones:checked {
    box-shadow: 9px 9px 16px rgba(189, 189, 189, 0.6), -9px -9px 16px rgba(255, 255, 255, 0.5), inset 10px 10px 15px -10px #0047b9, inset -10px -10px 15px -10px #0047b9;
  }
}
.opciones:checked::before {
  left: 8rem;
  box-shadow: none;
}
.opciones:checked::after {
  content: "Binaria";
  left: 3rem;
  color: #f5f5f7;
}
                  
        </style>

        <input style="width: 150px; height: 45px;"  onclick="catalogo('allow')" class="opciones" type="checkbox" id="toggle">

        </td>

      </tr>
 
    </tbody>
  </table>



    </div>
 
 <!-- CATALOGO CONFIG -->


 <!-- CATALOGO ESTADISTICAS -->
<div class="row" style="margin-left: 2%; margin-right: 2%;">
   <div class="col"> <button style="border-radius: 30px; height: 40px; width: 100px;" type="button" onclick="select_all();" class="btn btn-dark">Select</button></div>
   <div class="col"> <button style="border-radius: 30px; height: 40px; width: 100px;" type="button" onclick="unselect_all();" class="btn btn-dark">Unselect</button></div>
   <div class="col" id="win" style="font-size: 15px; color: azure;"></div>
   <div class="col" id="g1" style="font-size: 15px; color: azure;"></div>
   <div class="col" id="g2" style="font-size: 15px; color: azure;"></div>
   <div class="col" id="g3" style="font-size: 15px; color: azure;"></div>
   <div class="col" id="g4" style="font-size: 15px; color: azure;"></div>
   <div class="col" id="g5" style="font-size: 15px; color: azure;"></div>
   <div class="col" id="hit" style="font-size: 15px; color: azure;"></div>
   <div class="col" id="none" style="font-size: 15px; color: azure;"></div>
   <div class="col" id="doshit" style="font-size: 15px; color: azure;"></div>
   <div class="col" id="treshit" style="font-size: 15px; color: azure;"></div>

   <div class="col">
      <select  class="form-select form-select-sm" aria-label=".form-select-sm example" 
      style="
      margin-top: 0px; filter: drop-shadow(0px 0px 16px rgba(107, 228, 255, 0.34));
                   width: 100px;
                   height: 40px;
                   color: #eff5f8;
                   border: 2px solid #00a7ff;
                   border-radius: 73px; 
                   font-weight: 300;
                   font-size: 16px;
                   line-height: 25px;
                   background-color:transparent;
                   position: absolute;
                   cursor: pointer;
                   
      "
    >
    <option style="color: #003C74;"id="cuatrohit" selected></option>
    <option style="color: #003C74;"id="cincohit"></option>
    <option style="color: #003C74;"id="seishit"></option>
    <option style="color: #003C74;"id="sietehit"></option>
    <option style="color: #003C74;"id="ochohit"></option>
    <option style="color: #003C74;"id="nuevehit"></option>
    <option style="color: #003C74;"id="diezhit"></option>
  </select>

   <select onchange="porcentaje();" class="form-control" id="modo_entrada_catalogo" style="width: 100px; margin-left: 130px; 
   margin-top: 0px; filter: drop-shadow(0px 0px 16px rgba(107, 228, 255, 0.34));
   margin-right: 10px;
                   width: 100px;
                   height: 40px;
                   color: #eff5f8;
                   border: 2px solid #00a7ff;
                   border-radius: 73px; 
                   font-weight: 300;
                   font-size: 16px;
                   line-height: 25px;
                   background-color:transparent;
                   cursor: pointer;
   ">
      <option style="color: #003C74;" value="1"  selected>Modo Entrada</option>
      <option style="color: #003C74;"value="2">Vela 2</option>
      <option style="color: #003C74;"value="3">Vela 3</option>
      <option style="color: #003C74;"value="4">Vela 4</option>
      <option style="color: #003C74;"value="5">Vela 5</option>
   </select>
     </div> 
</div> 
<!-- CATALOGO ESTADISTICAS -->


<!-- CATALOGO CUADRANTES -->
<div id="pos1" class="row row-cols-6" style="margin-left: 4%; margin-right: 2%;">      
</div>
<!-- CATALOGO CUADRANTES -->


    <style>
        .col{
             float: left;
             margin-left: 2px; 
            }
        
    </style>



<script>



const catalogo = async (destino) => {
      var recordar = []
      var recordar2 = {}
      var tipo_mercado = ''
      var tipo_mercado2 = document.getElementById('toggle')
              if (tipo_mercado2.checked){ 
                   tipo_mercado = 'binaria'
              }else{tipo_mercado = 'digital'}
        
      var martingala = document.getElementById("mg_catalogo").value 
      var cuadrante = document.getElementById("cuadrantes_catalogo").value 

      var catalogo_config = { 
       "martingala"     : martingala,
       "cuadrante"      : cuadrante,
       "destino"        : destino,
       "tipo_mercado"   : tipo_mercado,
        };
    
        
        for (let i = 0; i < 125; i++){
          try{
              var rec_check = document.getElementById(`check${i}`)
              if (rec_check.checked){
                  recordar2 = {
                  'nombre_check': rec_check.dataset.nombre,
                  'par_check': rec_check.dataset.divisa}
                  recordar.push(recordar2);}
                }catch(error){}}         

        try {
            const response=await fetch("operaciones/", {
               method: "POST",
               body: JSON.stringify(catalogo_config),
               });

            const data=await response.json();
            const datos = data.data
            num = datos.length
            var pares = []
            var estrategia = []
            var estrategia_selected3 = []
            var par_selected3 = []
            var vueltas = 0
            var vueltas2 = 0

            borrar();

            const pos1 = document.querySelector("#pos1"); 



          var estrategia_selected2 = document.getElementById("estrategia_catalogo").value
          var estrategia_selected =document.getElementById("estrategia_catalogo");
          for (var i = 0; i < estrategia_selected.options.length; i++) {
           if(estrategia_selected.options[i].selected ==true){ 
            estrategia_selected3.push(estrategia_selected.options[i].value)             
           }}
          if(estrategia_selected2 == 'todas' || estrategia_selected2 == ""){}else{vueltas = estrategia_selected3.length}
      
       
          var par_selected2 = document.getElementById("pares_catalogo").value
          var par_selected =document.getElementById("pares_catalogo");
          for (var i = 0; i < par_selected.options.length; i++) {
           if(par_selected.options[i].selected ==true){ 
            par_selected3.push(par_selected.options[i].value)             
           }}
           console.log(par_selected3)
          if(par_selected2 == 'todas' || par_selected2 == ""){}else{vueltas2 = par_selected3.length}



          for (let i = 0; i < datos.length; i++) {
            if(estrategia_selected2 == 'todas' || estrategia_selected2 == ""){vueltas = 1}
            if(par_selected2 == 'todos' || par_selected2 == ""){vueltas2 = 1}
            for (x = 0; x < vueltas; x++) { 
                  if(datos[i].nombre == estrategia_selected3[x] || estrategia_selected2 == 'todas' || estrategia_selected2 == "" ){
            for (y = 0; y < vueltas2; y++) {
                  if(datos[i].divisa ==  par_selected3[y] || par_selected2 == "todos"|| par_selected2 == ""){
           pos1.insertAdjacentHTML("beforeend", `<div id="pos2${i}" class="col" style="background-color: transparent; margin: 1%; width: 15rem;">`);
           const pos2 = document.querySelector(`#pos2${i}`); 
           var img_divisas = `<img width="25" height="25" src="https://i.imgur.com/oaxYuCb.png" alt="Portada">`
           
           if(datos[i].divisa == "EURUSD-OTC"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/eurusd-otc.png' %}" alt="Portada">`}
           if(datos[i].divisa == "EURJPY-OTC"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/eurjpy-otc.png' %}" alt="Portada">`}
           if(datos[i].divisa == "GBPJPY-OTC"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/gbpusd-otc.png' %}" alt="Portada">`}
           if(datos[i].divisa == "GBPUSD-OTC"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/gbpjpy-otc.png' %}" alt="Portada">`}
           if(datos[i].divisa == "AUDCAD-OTC"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/audcad-otc.png' %}" alt="Portada">`}
           if(datos[i].divisa == "USDCHF-OTC"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/usdchf-otc.png' %}" alt="Portada">`}
           if(datos[i].divisa == "NZDUSD-OTC"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/nzdusd-otc.png' %}" alt="Portada">`}
           if(datos[i].divisa == "EURGBP-OTC"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/eurgbp-otc.png' %}" alt="Portada">`}
           if(datos[i].divisa == "AUDUSD-OTC"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/audusd-otc.png' %}" alt="Portada">`}


           if(datos[i].divisa == "EURUSD"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/eurusd.png' %}" alt="Portada">`}
           if(datos[i].divisa == "EURJPY"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/eurjpy.png' %}" alt="Portada">`}
           if(datos[i].divisa == "GBPUSD"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/gbpusd.png' %}" alt="Portada">`}
           if(datos[i].divisa == "GBPJPY"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/gbpjpy.png' %}" alt="Portada">`}
           if(datos[i].divisa == "AUDCAD"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/audcad.png' %}" alt="Portada">`}
           if(datos[i].divisa == "USDCHF"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/usdchf.png' %}" alt="Portada">`}
           if(datos[i].divisa == "NZDUSD"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/nzdusd.png' %}" alt="Portada">`}
           if(datos[i].divisa == "EURGBP"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/eurgbp.png' %}" alt="Portada">`}
           if(datos[i].divisa == "AUDUSD"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/audusd.png' %}" alt="Portada">`}
           if(datos[i].divisa == "XRPUSD"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/xrpusd.png' %}" alt="Portada">`}
           if(datos[i].divisa == "USDJPY"){img_divisas = `<img width="25" height="25" src="{% static 'img/divisas/usdjpy.png' %}" alt="Portada">`}
 


           pos2.insertAdjacentHTML("beforeend", `<div style="color: azure; font-size: 13px;">${img_divisas}&nbsp${datos[i].divisa}&nbsp &nbsp ${data.type} &nbsp &nbsp  <input onclick="porcentaje();" id="check${i}" data-nombre= "${datos[i].nombre}" data-divisa= "${datos[i].divisa}" data-comision= "${datos[i].comision }" style="margin-top: 10px;" type="checkbox" id="cbox2" value="second_checkbox"></div>`);
           pos2.insertAdjacentHTML("beforeend", `<div style="color: azure; float: left;">${ datos[i].nombre }<span style="margin-left: 10px;" class="counter">60</span> </div>`);
           if(datos[i].porciento > 89.99) { pos2.insertAdjacentHTML("beforeend", `<div style="color: #0cce91; text-align: right;">${ datos[i].porciento }%</div>`); }
           if(datos[i].porciento > 79.99 && datos[i].porciento < 90 ) { pos2.insertAdjacentHTML("beforeend", `<div style="color: #e4f30e; text-align: right;">${ datos[i].porciento }%</div>`); }
           if(datos[i].porciento < 80) { pos2.insertAdjacentHTML("beforeend", `<div style="color: #f3324d; text-align: right;">${ datos[i].porciento }%</div>`); }
           if(pares.includes(datos[i].divisa) === false){
           pares.push(datos[i].divisa);
           }
           if(estrategia.includes(datos[i].nombre) === false){
           estrategia.push(datos[i].nombre);
           }
        
    
           const catalogo = datos[i].catalogo
        
           for (let x = 0; x < catalogo.length; x++) {
            
            if(catalogo[x] == 'win') { pos2.insertAdjacentHTML("beforeend", `  <div  class="col"> <img src="{% static 'img/win.jpg' %}" alt="Portada" width="23px" height="12px"> </div>`); }
            if(catalogo[x] == 'g1') { pos2.insertAdjacentHTML("beforeend", `   <div class="col">  <img src="{% static 'img/mg1.jpg' %}" alt="Portada" width="23px" height="12px"> </div>`); }
            if(catalogo[x] == 'g2') { pos2.insertAdjacentHTML("beforeend", `   <div  class="col"> <img src="{% static 'img/mg2.jpg' %}" alt="Portada" width="23px" height="12px"> </div>`); }
            if(catalogo[x] == 'g3') { pos2.insertAdjacentHTML("beforeend", `   <div  class="col"> <img src="{% static 'img/mg3.jpg' %}" alt="Portada" width="23px" height="12px"> </div>`); }
            if(catalogo[x] == 'g4') { pos2.insertAdjacentHTML("beforeend", `   <div  class="col"> <img src="{% static 'img/mg4.jpg' %}" alt="Portada" width="23px" height="12px"> </div>`); }
            if(catalogo[x] == 'g5') { pos2.insertAdjacentHTML("beforeend", `   <div  class="col"> <img src="{% static 'img/mg5.jpg' %}" alt="Portada" width="23px" height="12px"> </div>`); }
            if(catalogo[x] == 'hit') { pos2.insertAdjacentHTML("beforeend", `  <div  class="col"> <img src="{% static 'img/hit.jpg' %}" alt="Portada" width="23px" height="12px"> </div>`); }
            if(catalogo[x] == 'none') { pos2.insertAdjacentHTML("beforeend", ` <div  class="col"> <img src="{% static 'img/none.jpg' %}" alt="Portada" width="23px" height="12px"> </div>`); }
            if(catalogo[x] == 'p1') { pos2.insertAdjacentHTML("beforeend", ` <div  class="col"> <img src="{% static 'img/p1.jpg' %}" alt="Portada" width="23px" height="12px"> </div>`); }
            if(catalogo[x] == 'p2') { pos2.insertAdjacentHTML("beforeend", ` <div  class="col"> <img src="{% static 'img/p2.jpg' %}" alt="Portada" width="23px" height="12px"> </div>`); }
            if(catalogo[x] == 'p3') { pos2.insertAdjacentHTML("beforeend", ` <div  class="col"> <img src="{% static 'img/p3.jpg' %}" alt="Portada" width="23px" height="12px"> </div>`); }
            if(catalogo[x] == 'p4') { pos2.insertAdjacentHTML("beforeend", ` <div  class="col"> <img src="{% static 'img/p4.jpg' %}" alt="Portada" width="23px" height="12px"> </div>`); }
            if(catalogo[x] == 'p5') { pos2.insertAdjacentHTML("beforeend", ` <div  class="col"> <img src="{% static 'img/p5.jpg' %}" alt="Portada" width="23px" height="12px"> </div>`); }
             
          }
           pos2.insertAdjacentHTML("beforeend", `</div>`);
          }
         }
        }
        }
        }
        

        
        if(par_selected2 == "todas" || par_selected2 == ""){
        borrar_pares();
        const select_pares = document.querySelector("#pares_catalogo");
        select_pares.insertAdjacentHTML("beforeend", `<option style="color: #212529;" value="todos">TODOS</option>`); 
        for (let y = 0; y < pares.length; y++){
           select_pares.insertAdjacentHTML("beforeend", `<option style="color: #212529;" value="${pares[y]}"> ${pares[y]} </option>`);  }}
              
         
        if(estrategia_selected2 == "todas" || estrategia_selected2 == ""){   
        borrar_estrategias();
        const select_estrategia = document.querySelector("#estrategia_catalogo");
        select_estrategia.insertAdjacentHTML("beforeend", `<option style="color: #003C74;" value="todas">TODAS</option>`); 
        for (let y = 0; y < estrategia.length; y++){
           select_estrategia.insertAdjacentHTML("beforeend", `<option style="color: #003C74;" value="${estrategia[y]}"> ${estrategia[y]} </option>`);}}    
           
           
        document.getElementById("win").innerHTML = ""
        document.getElementById("g1").innerHTML = ""
        document.getElementById("g2").innerHTML = ""
        document.getElementById("g3").innerHTML = ""
        document.getElementById("g4").innerHTML = ""
        document.getElementById("g5").innerHTML = ""
        document.getElementById("hit").innerHTML = ""
        document.getElementById("none").innerHTML = ""
        document.getElementById("cincohit").innerHTML = ""
        document.getElementById("seishit").innerHTML = ""
        document.getElementById("sietehit").innerHTML = ""
        document.getElementById("ochohit").innerHTML = ""
        document.getElementById("nuevehit").innerHTML = ""
        document.getElementById("diezhit").innerHTML = ""
        
        
        for (let i = 0; i < num; i++){
          try{
            click = false
           var rec = document.getElementById(`check${i}`)
           for(let x = 0; x < recordar.length; x++){ 
              if (rec.dataset.nombre == recordar[x].nombre_check && rec.dataset.divisa == recordar[x].par_check){
                rec.click() 
              }         
        }
        

        }catch(error){}}
        click = true
        porcentaje()
        
        }catch (error){
            console.log(error)
        }
    }



function borrar(){
        var div = document.getElementById('pos1');
        if(div !== null){
        while (div.hasChildNodes()){
            div.removeChild(div.lastChild);
        }
    }else{
        alert ("No existe la caja previamente creada.");
    }
    }

function borrar_pares(){
        var div = document.getElementById('pares_catalogo');
        if(div !== null){
        while (div.hasChildNodes()){
            div.removeChild(div.lastChild);
        }
    }else{
        alert ("No existe la caja previamente creada.");
    }}

function borrar_estrategias(){
        var div = document.getElementById('estrategia_catalogo');
        if(div !== null){
        while (div.hasChildNodes()){
            div.removeChild(div.lastChild);
        }
    }else{
        alert ("No existe la caja previamente creada.");
    }}


const porcentaje = async () => {
      if(click){
        
        try {
        document.getElementById("win").innerHTML = ""
        document.getElementById("g1").innerHTML = ""
        document.getElementById("g2").innerHTML = ""
        document.getElementById("g3").innerHTML = ""
        document.getElementById("g4").innerHTML = ""
        document.getElementById("g5").innerHTML = ""
        document.getElementById("hit").innerHTML = ""
        document.getElementById("none").innerHTML = ""
        document.getElementById("doshit").innerHTML = ""
        document.getElementById("treshit").innerHTML = ""
        document.getElementById("cuatrohit").innerHTML = ""
        document.getElementById("cincohit").innerHTML = ""
        document.getElementById("seishit").innerHTML = ""
        document.getElementById("sietehit").innerHTML = ""
        document.getElementById("ochohit").innerHTML = ""
        document.getElementById("nuevehit").innerHTML = ""
        document.getElementById("diezhit").innerHTML = ""
        var modo_entrada_catalogo = document.getElementById("modo_entrada_catalogo").value
       
          var porcentaje = []
          for (let i = 0; i < num; i++){
            try{
            var estrategia = document.getElementById(`check${i}`)
            if (estrategia.checked)
              {
                    var porcentaje_list = { 
                    "estrategia"     : estrategia.dataset.nombre,
                    "par"            : estrategia.dataset.divisa,
                    "modo_entrada"   : modo_entrada_catalogo
                      };
              porcentaje.push(porcentaje_list);
              }     
           }catch(error){}} 


           const response=await fetch("./porcentaje/",{
               method: "POST",
               body: JSON.stringify(porcentaje),
               })

            const data=await response.json();
            const estadistica = data.estadistica

            if(estadistica.win != "0"){document.getElementById("win").innerHTML = "Win: " + estadistica.win}
            if(estadistica.g1 != "0"){document.getElementById("g1").innerHTML = "G1: " + estadistica.g1}
            if(estadistica.g2 != "0"){document.getElementById("g2").innerHTML = "G2: " + estadistica.g2}
            if(estadistica.g3 != "0"){document.getElementById("g3").innerHTML = "G3: " + estadistica.g3}
            if(estadistica.g4 != "0"){document.getElementById("g4").innerHTML = "G4: " + estadistica.g4}
            if(estadistica.g5 != "0"){document.getElementById("g5").innerHTML = "G5: " + estadistica.g5}
    
            document.getElementById("hit").innerHTML = "Hit: " + estadistica.hit
            document.getElementById("none").innerHTML = "None: " + estadistica.none
            document.getElementById("doshit").innerHTML = "2 Hit: " + estadistica.doshit
            document.getElementById("treshit").innerHTML = "3 Hit: " + estadistica.treshit
            document.getElementById("cuatrohit").innerHTML = "4 Hit: " + estadistica.cuatrohit
            document.getElementById("cincohit").innerHTML = "5 Hit: " + estadistica.cincohit
            document.getElementById("seishit").innerHTML = "6 Hit: " + estadistica.seishit
            document.getElementById("sietehit").innerHTML = "7 Hit: " + estadistica.sietehit
            document.getElementById("ochohit").innerHTML = "8 Hit: " + estadistica.ochohit
            document.getElementById("nuevehit").innerHTML = "9 Hit: " + estadistica.nuevehit
            document.getElementById("diezhit").innerHTML = "10 Hit: " + estadistica.diezhit
                 
            document.getElementById('mensajes').innerHTML = "Advice: Esta es tu seccion de avisos."

          }catch{document.getElementById('mensajes').innerHTML = "Advice: Error al ver porcentajes"}
        }else{}
    }
 
const stop = async () => {
  try {
      document.getElementById("ordenes_enviadas").innerHTML= "Operaciones detenidas 🛑"
      document.getElementById("start").disabled = false;
      document.getElementById("stop").disabled = true;
      const response=await fetch("./stop/");
      const stoped = await response.json();   
} catch(error){} }





const conectar = async (email,password,modo) => {

   var email = document.getElementById("email").value
   var password = document.getElementById("password").value
   var modo = document.getElementById("modo").value
   if(email.length == 0 || password.length == 0 || modo.length == 0 || modo == "NONE"){document.getElementById('mensajes').innerHTML = "Advice: Compruebe que todos los campos estan llenos"}
   else{
    document.getElementById('mensajes').innerHTML = "Advice: Esta es tu seccion de avisos."
   var credenciales = { 
       "email"     : email,
       "password"   : password,
       "modo"      : modo
        };
       try {
           const response=await fetch("./conectar/",{
               method: "POST",
               body: JSON.stringify(credenciales),
               })
               
           const status = await response.json();

         
              if(status.mensaje){
              var modal2 = document.getElementById("myModal2");
              modal2.style.display = "block";
              }else
             {

           document.getElementById("estado").innerHTML = status.balance.estado
           document.getElementById("modo2").innerHTML = status.balance.modo
           document.getElementById("balance").innerHTML= status.balance.balance
           catalogo()
           setInterval(catalogo, 300000);
          }
        
       }catch (error){
        document.getElementById('mensajes').innerHTML = error
       } }
}


const conectar2 = async () => {

var modo2 = document.getElementById("modo").value
var codigo = document.getElementById("twofactor").value

if(codigo.length == 0 || codigo == "NONE"){document.getElementById('mensajes').innerHTML = "Advice: No ha escrito el codigo"}
else{
 document.getElementById('mensajes').innerHTML = "Advice: Esta es tu seccion de avisos."
 
var credenciales = { 
    "codigo"     : codigo,
    "modo"       : modo2
     };

    try {
        const response=await fetch("./conectar2/",{
            method: "POST",
            body: JSON.stringify(credenciales),
            })
            
        const status = await response.json();

         try{ 
           document.getElementById('mensajes').innerHTML = "Advice: Esta es tu seccion de avisos."
           var modal2 = document.getElementById("myModal2");
           modal2.style.display = "none";
           document.getElementById("estado").innerHTML = status.balance.estado
           document.getElementById("modo2").innerHTML = status.balance.modo
           document.getElementById("balance").innerHTML= status.balance.balance
           catalogo()
           setInterval(catalogo, 300000);

          }catch (error){
            document.getElementById('mensajes').innerHTML = "Advice: Ha ocurrido un error, confirme que el codigo es es correcto."
        
       }
     
    }catch (error){
     document.getElementById('mensajes').innerHTML = error
    } }
}


function select_all(){
  for (let i = 0; i < num; i++){
          try{
           var rec = document.getElementById(`check${i}`)
           rec.checked = true
           
              } catch(error){}       
        }

porcentaje();      
           
}


function unselect_all(){
  for (let i = 0; i < num; i++){
          try{
           var rec = document.getElementById(`check${i}`)
           rec.checked = false
              } catch(error){}       
        }

porcentaje();           
}


const pizarra = async () => {
  try {
           const response=await fetch("./resultados/")
           const resultado = await response.json();
           document.getElementById("ganadas").innerHTML = "Win: " + resultado.ganadas
           document.getElementById("perdidas").innerHTML = "Loose: " + resultado.perdidas
           document.getElementById("balance").innerHTML= resultado.balance

           if(resultado.stop_gain_advice == "active"){
           document.getElementById("ordenes_enviadas").innerHTML= "Stop Gain 🛑"  
           document.getElementById("start").disabled = false;
           document.getElementById("stop").disabled = true;}

           if(resultado.stop_loss_advice == "active"){
           document.getElementById("ordenes_enviadas").innerHTML= "Stop Loss 🛑" 
           document.getElementById("start").disabled = false;
           document.getElementById("stop").disabled = true;}
           
           if(resultado.num_advice == "active"){
           document.getElementById("ordenes_enviadas").innerHTML= "Operaciones End 🛑" 
           document.getElementById("start").disabled = false;
           document.getElementById("stop").disabled = true;
           }

           if(resultado.stop_advice == "active"){
           document.getElementById("ordenes_enviadas").innerHTML= "Operaciones detenidas 🛑"
           document.getElementById("start").disabled = false;
           document.getElementById("stop").disabled = true;
           }
          }
           catch(error){}  
}


const buy_sell = async () => {
        var check = false
        var ordenes = []
        var datos_buy2 = {}
        var datos_buy = []
        var indicador = ""
        var tecnico = document.getElementById("check_tecnico")
        if (tecnico.checked){ indicador = "on"  }else{indicador="off"}
        var importe = document.getElementById("importe").value
        var martingala = document.getElementById("martingala").value
        var tipo_martingala = document.getElementById("tipo_martingala").value
        var modo_entrada = document.getElementById("modo_entrada").value
        var num_operaciones = document.getElementById("operaciones").value
        var after_loss = document.getElementById("after_loss").value
        var operaciones_al = document.getElementById("operaciones_al").value
        var martingala_al = document.getElementById("martingala_al").value
        var stop_gain = document.getElementById("stop_gain").value
        var stop_loss = document.getElementById("stop_loss").value
        
        const resultados_2 = setInterval(pizarra, 60000); 
        if(importe.length == 0 || num_operaciones.length == 0){document.getElementById('mensajes').innerHTML = "Advice: Debe especificar el 'importe' y el 'num. de operaciones'"}
        else{
        document.getElementById('mensajes').innerHTML = "Advice: Esta es tu seccion de avisos." 
        for (let i = 0; i < num; i++){  
            try{
              var estrategia = document.getElementById(`check${i}`)
            if (estrategia.checked)
              {check = true
                datos_buy2 = {
                 "estrategia": estrategia.dataset.nombre,
                 "divisa"    : estrategia.dataset.divisa,
                 "comision"  : estrategia.dataset.comision
                }
                
                datos_buy.push(datos_buy2);
            
              } }catch(error){}
                  
        } 

        var divisasDiferentes = new Set();
        for (var i = 0; i < datos_buy.length; i++) {
            divisasDiferentes.add(datos_buy[i].divisa);
        }
        var cantidadDivisasDiferentes = divisasDiferentes.size;
        if (cantidadDivisasDiferentes > 1){
          document.getElementById('mensajes').innerHTML = "Advice: Para el buen funcionamiento del Bot, debe utilizar solo una divisa a la vez."  

        }
        else{

          document.getElementById('mensajes').innerHTML = "Advice: Esta es tu seccion de avisos."

        if(check == false){document.getElementById('mensajes').innerHTML = "Advice: No ha seleccionado ninguna estrategia"}
        else{
          document.getElementById('mensajes').innerHTML = "Advice: Esta es tu seccion de avisos."
        var llamada = { 
        "datos_buy"        :datos_buy,
        "importe"          :importe,
        "martingala"       :martingala,
        "tipo_martingala"  :tipo_martingala,
        "num"              :num_operaciones,
        "modo_entrada"     :modo_entrada,
        "after_loss"       :after_loss,
        "operaciones_al"   :operaciones_al,
        "martingala_al"    :martingala_al,
        "stop_gain"        :stop_gain,
        "stop_loss"        :stop_loss,
        "tecnico"          :indicador
        }
        
        document.getElementById("start").disabled = true;
        document.getElementById("stop").disabled = false;

        try {
            document.getElementById("ordenes_enviadas").innerHTML = "Ordenes enviadas. Espera🕐" 
            const response=await fetch("./buy_sell/",{
                method: "POST",
                body: JSON.stringify(llamada),
                })  
                const resultado = await response.json(); 
                document.getElementById('mensajes').innerHTML = "Advice: Esta es tu seccion de avisos."
        }catch (error){
            document.getElementById('mensajes').innerHTML = "Advice: Error en compra o venta / revice su connexion"
        } 

        }   
      }}}


document.getElementById('btn_register').hidden = true 


</script>
{% if request.user.plan == "free" or request.user.plan == "regular" %}
<script>
  catalogo()
</script>
{% endif %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Select2 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
    <script>
      $("#pares_catalogo").select2({
          placeholder: "  Pares",
          allowClear: true
      });
  
      $("#estrategia_catalogo").select2({
          placeholder: "  Estrategia",
          allowClear: true
      });

       
    window.onbeforeunload = function() {
      stop()
      }

    </script>


<script>
  function actualizarSegundos() {
      var segundosDivs = document.querySelectorAll(".counter");

      var ahora = new Date();
      var segundos = ahora.getSeconds();
      var segundos_int = 60 - segundos
       

      var segundosTexto = segundos_int < 10 ? "0" + segundos_int : segundos_int;
      if(segundos_int == 60){
        segundosTexto = "00"
        catalogo("block")
      
      }

      segundosDivs.forEach(function(segundosDiv) {
          segundosDiv.innerHTML = segundosTexto;
      });
  }

  // Actualiza los segundos cada segundo
  setInterval(actualizarSegundos, 1000);
</script>

<script>
$('#estrategia_catalogo').on('select2:select', function (e) {
  catalogo('allow')
});
</script>

<script>
  $('#pares_catalogo').on('select2:select', function (e) {
    catalogo('allow')
  });
  </script>

<script>
  // Función para recargar la página
  function recargarPagina() {
      location.reload();
  }

  // Establecer un temporizador para recargar la página cada 20 minutos
  setTimeout(recargarPagina, 1200000); // 1200000 milisegundos = 20 minutos

  catalogo('allow')
</script>


<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
{% endblock %}